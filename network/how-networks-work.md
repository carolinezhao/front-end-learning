# Network

- 客户端 Chapter 1
- 服务器 Chapter 6

## Chapter 1 浏览器生成消息

### 1.1 生成 HTTP 请求消息

浏览器解析 URL 并生成 HTTP 消息

### 1.2 向 DNS 服务器查询 Web 服务器的 IP 地址

TCP/IP 的基本思路

* 集线器连接起来的设备属于一个子网，子网通过路由器连接起来组成大的网络。
* 数据以包的形式传送 --> 集线器 --> 最近的路由器 --> 子网内的集线器 --> 下一个路由器 --> ... --> 目的地
* 根据 IP 地址判断访问对象位置。

图 1.9 IP 地址和子网掩码

* IP 地址：共 32 比特，8 比特 (1 字节) 分为一组，分别用十进制表示，再用圆点隔开。网络号和主机号总共 32 比特，但是具体的分配关系不固定。
* 子网掩码：用于表示 IP 地址的内部结构。长度也是 32 比特，为 1 的部分对应网络号，为 0 的部分对应主机号。

1 Byte = 8 bit

* 比特/二进制位 bit：计算机内部数据储存的最小单位。
* 字节 Byte：计算机中数据处理的基本单位。
* 英文字母占 1 个字节空间，中文汉字占 2 个字节空间。

委托操作系统将消息发送给 Web 服务器

* 域名解析 (resolution)：通过 DNS 查询 IP 地址
* DNS 解析器 (resolver)：作为 DNS 客户端
* Socket 库：用于调用网络功能的程序组件集合。解析器是库中的一种程序组件。

根据域名查询 IP 地址时，浏览器会使用 Socket 库中的解析器，向 DNS 服务器发出查询消息。<br>
解析器从响应消息中取出 IP 地址，写入浏览器指定的内存地址中。<br>
浏览器向 Web 服务器发送消息时，从该内存地址取出 IP 地址，将它和 HTTP 请求消息一起交给操作系统。

图 1.12 解析器的内部工作流程

DNS 消息是用二进制数据编写的。<br>
发送消息委托给操作系统内的**协议栈**执行，通过网卡将消息发送给 DNS 服务器。

图 1.14 DNS 服务器的基本工作

### 1.3 全世界 DNS 服务器的大接力

来自客户端的查询消息包括：域名，Class，记录类型 (A 对应 IP 地址，A = Address)<br>
根据查询消息匹配记录，返回响应数据，即 IP 地址。

例：www.lab.glasscom.com

* 其中的"."用于划分不同层级的域，越靠右层级越高；
* 最顶层的域是根域，没有名字，因此书写时被忽略。

一个域的信息作为一个整体存放在 DNS 服务器中；一台服务器中可以存放多个域的信息。

下级 DNS 服务器的 IP 地址注册到上级 DNS 服务器中；根域 DNS 服务器的 IP 地址保存到所有 DNS 服务器中。

图 1.16 查询操作

* 客户端访问最近一台 DNS 服务器 (TCP/IP 设置中填写的 DNS 服务器地址)；
* 最近的 DNS 服务器向根域 DNS 服务器发送查询消息，返回下级域的 DNS 服务器地址；
* 依次类推，直到找到目标 DNS 服务器，返回 IP 地址。

图 1.16 相当于图 1.12 中的一个步骤

通过缓存加快 DNS 服务器的响应。超过有效期后，数据从缓存中删除。

### 1.4 委托协议栈发送消息