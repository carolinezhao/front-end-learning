## 第2章 词法作用域 lexical scope

作用域有2种主要的工作模型：词法作用域 (普遍，包括JS)；动态作用域 (少用)

### 词法作用域

* 定义在词法阶段 (参考1.1编译原理) 的作用域
* **是由书写代码时变量和函数声明的位置决定的**
* 词法分析器处理代码时保持作用域不变

### 作用域查找

* 逐级嵌套作用域 --> 逐级包含的气泡
* 查找从运行时所处的最内部作用域开始，逐级向外
* 在找到第一个匹配的标识符时停止
* “遮蔽效应”：多层嵌套作用域中存在同名标识符时，内部标识符会遮蔽外部标识符。
* 全局变量(a)自动成为全局对象的属性，通过引用全局对象属性(window.a)可以不受“遮蔽”影响。
* 非全局变量被遮蔽，无法访问。
* 只查找一级标识符，如 foo.bar 只查找 foo，对象属性访问规则接管对 bar 属性的访问。

### 性能

* JS 引擎会在**编译阶段**进行数项的性能优化。
* 有些优化依赖于能够根据代码的**词法**进行静态分析，**并预先确定全部标识符的位置以及如何声明的**，才能在执行过程中快速找到标识符。
* 如果引擎发现 eval(...) 或 with，只能简单假设关于标识符位置的判断都是**无效的**。

### 欺骗词法作用域

* 会导致性能下降，仅供了解，不要使用！！

eval(...)

* 通常被用来执行动态创建的代码。
* 如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域。

with

* 通常被作为重复引用同一个对象中的多个属性的快捷方式，可以不用重复引用对象本身。
* 实际上是根据传递给它的对象凭空创建了一个全新的词法作用域。