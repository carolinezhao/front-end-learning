## 第1章 作用域是什么

### 1.1 编译原理

JS 是编译语言。但不同于其他语言，JS 的编译过程不是发生在构建之前，而是在代码执行前的瞬间。

传统编译语言的编译步骤如下，JS 引擎要复杂得多。

1. 分词/词法分析 Tokenizing/Lexing

    字符串分解成词法单元 token<br>
    var a = 2; --> var, a, =, 2, ;

2. 解析/语法分析 Parsing

    词法单元流（数组）转换成 “抽象语法树 AST”

3. 代码生成

    AST 转换成可执行代码。

### 1.2 理解作用域

Roles

* 引擎 Engine
* 编译器 Compiler
* 作用域 Scope：是一套规则，用于确定在何处以及如何查找变量（标识符）。

Steps

    var a = 2;
    
可以看成两个完全不同的声明：一个由编译器在编译时处理；一个由引擎在运行时处理。

step1

    var a

编译器询问作用域：

    if (已经有该名称的变量) {
        编译器忽略该声明，继续编译
    } else {
        要求作用域声明一个新变量，命名为 a
    }

step2

    a = 2

编译器为引擎生成运行时所需的代码，用于处理赋值操作。

引擎询问作用域：

    if (查找存在叫做 a 的变量) {
        引擎使用这个变量
    } else {
        引擎继续查找该变量 【1.3内容】
        if (找到) {
            将 2 赋值给 a
        } else {
            抛出一个异常 【1.4内容】
        }
    }

引擎的查询方式：

* LHS 赋值操作的目标是谁 --> 找到变量的容器本身，对变量赋值
* RHS 谁是赋值操作的源头 --> 获取变量的值

### 1.3 作用域嵌套


### 1.4 异常
* ReferenceError 与作用域判别失败相关。
* TypeError 作用域判别成功了，但是对结果的操作是非法或不合理的。