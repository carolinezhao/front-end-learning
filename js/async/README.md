# Asynchronous

reference：你不知道的js 中卷 第二部分

## Chapter 1 异步：现在与将来

### 1.1 分块的程序

程序的一部分现在运行 (A)，另一部分在将来运行 (C)，现在和将来之间有段间隙，程序没有活跃执行 (如：等待用户输入/从数据库请求数据/通过网络发送数据等待响应……)。

A 和 C 的关系就是异步编程的核心。

单个 js 文件是由多个块构成的，其中只有一个现在执行，其余会在将来执行。
最常见的块单位是函数。

发送异步 Ajax 请求，将来才能得到返回结果，使用回调函数。

只要把一段代码包装成一个函数，并指定它在响应某个事件 (定时器/鼠标点击/Ajax 响应等) 时执行，就是在代码中创建了一个将来执行的块，由此引入了异步机制。 --> _async-1.js_

异步控制台

console.* 方法族不是 js 正式的一部分，而是由宿主环境添加到 js 中的。
某些条件下，会在后台异步处理控制台 I/O，表现为 console.log() 中的内容不会被立即打印。
解决：断点调试；把对象序列化到字符串中，强制执行一次“快照”？

### 1.2 Event Loop

直到 ES6，js 才真正内建有直接的异步概念。

js 的宿主环境 (浏览器/Node.js) 都提供了一种机制来处理程序中多个块的执行，且执行每个块时调用 js 引擎，这种机制称为事件循环。

伪代码帮助理解事件循环

setTimeout() 所做的只是设定一个定时器，定时器到时后，宿主环境会把回调函数放在事件循环中。
它只能决定程序不会在某个时间间隔之前运行，至于是在该时刻运行还是在之后运行，则由事件队列的状态而定。

### 1.3 并行线程

异步：是关于现在和将来的时间间隙。
并行：关于能够同时发生的事情。

进程和线程独立运行，并可能同时运行：在不同的处理器，甚至不同的计算机上，但多个线程能够共享单个进程的内存。？？

事件循环把自身的工作分成一个个任务并顺序执行，不允许对共享内存的并行访问和修改。
通过分立线程中彼此合作的事件循环，并行和顺序执行可以共存。？？

并行线程的交替执行和异步事件的交替调度，粒度是完全不同的。

完整运行 run-to-completion

js 单线程，不确定性只存在于函数(事件)顺序级别上，不同函数之间的语句不会交替运行。

### 1.4 并发 concurrence

向下滚动列表逐渐加载更多内容，至少需要两个独立的“进程”同时运行(是在同一时段内，并不需要在同一时刻)。
- 向下滚动页面触发 onscroll 事件时响应这些事件，发起 Ajax 请求新内容；
- 接收 Ajax 响应，把内容展示到页面。

非交互：任务彼此不相关

交互

协作

### 1.5 任务

任务队列 job queue

### 1.6 语句顺序

## Chapter 2 Callback

## Chapter 3 Promise
